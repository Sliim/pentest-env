def target(vconfig, custom)
  vconfig.vm.define custom['name'], autostart: false do |target|

    target.vm.box = 'rapid7/metasploitable3-win2k8'
    target.vm.hostname = 'metasploitable3-win2k8'
    target.vm.communicator = 'winrm'
    target.winrm.retry_limit = 60
    target.winrm.retry_delay = 10

    target.vm.synced_folder '.', '/vagrant', disabled: true

    case ENV['MS3_DIFFICULTY']
      when 'easy'
        target.vm.provision :shell, inline: "C:\\startup\\disable_firewall.bat"
      else
        target.vm.provision :shell, inline: "C:\\startup\\enable_firewall.bat"
        target.vm.provision :shell, inline: "C:\\startup\\configure_firewall.bat"
    end

    target.vm.provision :shell, inline: "C:\\startup\\install_share_autorun.bat"
    target.vm.provision :shell, inline: "C:\\startup\\setup_linux_share.bat"
    target.vm.provision :shell, inline: "rm C:\\startup\\*" # Cleanup startup scripts

    target.vm.provider 'virtualbox' do |v|
      v.customize ['modifyvm', :id, '--name', "pentest-env-#{custom['name']}"]
      v.customize ['modifyvm', :id, '--memory', 2048]
    end
  end
end
